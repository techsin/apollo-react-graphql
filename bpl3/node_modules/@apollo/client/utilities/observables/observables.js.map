{"version":3,"file":"observables.js","sources":["observables.js"],"sourcesContent":["import { Observable } from './Observable';\nexport function multiplex(inner) {\n    var observers = new Set();\n    var sub = null;\n    return new Observable(function (observer) {\n        observers.add(observer);\n        sub = sub || inner.subscribe({\n            next: function (value) {\n                observers.forEach(function (obs) { return obs.next && obs.next(value); });\n            },\n            error: function (error) {\n                observers.forEach(function (obs) { return obs.error && obs.error(error); });\n            },\n            complete: function () {\n                observers.forEach(function (obs) { return obs.complete && obs.complete(); });\n            },\n        });\n        return function () {\n            if (observers.delete(observer) && !observers.size && sub) {\n                sub.unsubscribe();\n                sub = null;\n            }\n        };\n    });\n}\nexport function asyncMap(observable, mapFn) {\n    return new Observable(function (observer) {\n        var next = observer.next, error = observer.error, complete = observer.complete;\n        var activeNextCount = 0;\n        var completed = false;\n        var handler = {\n            next: function (value) {\n                ++activeNextCount;\n                new Promise(function (resolve) {\n                    resolve(mapFn(value));\n                }).then(function (result) {\n                    --activeNextCount;\n                    next && next.call(observer, result);\n                    completed && handler.complete();\n                }, function (e) {\n                    --activeNextCount;\n                    error && error.call(observer, e);\n                });\n            },\n            error: function (e) {\n                error && error.call(observer, e);\n            },\n            complete: function () {\n                completed = true;\n                if (!activeNextCount) {\n                    complete && complete.call(observer);\n                }\n            },\n        };\n        var sub = observable.subscribe(handler);\n        return function () { return sub.unsubscribe(); };\n    });\n}\n//# sourceMappingURL=observables.js.map"],"names":[],"mappings":";;;AACO,SAAS,SAAS,CAAC,KAAK,EAAE;IAC7B,IAAI,SAAS,GAAG,IAAI,GAAG,EAAE,CAAC;IAC1B,IAAI,GAAG,GAAG,IAAI,CAAC;IACf,OAAO,IAAI,UAAU,CAAC,UAAU,QAAQ,EAAE;QACtC,SAAS,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC;QACxB,GAAG,GAAG,GAAG,IAAI,KAAK,CAAC,SAAS,CAAC;YACzB,IAAI,EAAE,UAAU,KAAK,EAAE;gBACnB,SAAS,CAAC,OAAO,CAAC,UAAU,GAAG,EAAE,EAAE,OAAO,GAAG,CAAC,IAAI,IAAI,GAAG,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,EAAE,CAAC,CAAC;aAC7E;YACD,KAAK,EAAE,UAAU,KAAK,EAAE;gBACpB,SAAS,CAAC,OAAO,CAAC,UAAU,GAAG,EAAE,EAAE,OAAO,GAAG,CAAC,KAAK,IAAI,GAAG,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC,EAAE,CAAC,CAAC;aAC/E;YACD,QAAQ,EAAE,YAAY;gBAClB,SAAS,CAAC,OAAO,CAAC,UAAU,GAAG,EAAE,EAAE,OAAO,GAAG,CAAC,QAAQ,IAAI,GAAG,CAAC,QAAQ,EAAE,CAAC,EAAE,CAAC,CAAC;aAChF;SACJ,CAAC,CAAC;QACH,OAAO,YAAY;YACf,IAAI,SAAS,CAAC,MAAM,CAAC,QAAQ,CAAC,IAAI,CAAC,SAAS,CAAC,IAAI,IAAI,GAAG,EAAE;gBACtD,GAAG,CAAC,WAAW,EAAE,CAAC;gBAClB,GAAG,GAAG,IAAI,CAAC;aACd;SACJ,CAAC;KACL,CAAC,CAAC;CACN;AACD,AAAO,SAAS,QAAQ,CAAC,UAAU,EAAE,KAAK,EAAE;IACxC,OAAO,IAAI,UAAU,CAAC,UAAU,QAAQ,EAAE;QACtC,IAAI,IAAI,GAAG,QAAQ,CAAC,IAAI,EAAE,KAAK,GAAG,QAAQ,CAAC,KAAK,EAAE,QAAQ,GAAG,QAAQ,CAAC,QAAQ,CAAC;QAC/E,IAAI,eAAe,GAAG,CAAC,CAAC;QACxB,IAAI,SAAS,GAAG,KAAK,CAAC;QACtB,IAAI,OAAO,GAAG;YACV,IAAI,EAAE,UAAU,KAAK,EAAE;gBACnB,EAAE,eAAe,CAAC;gBAClB,IAAI,OAAO,CAAC,UAAU,OAAO,EAAE;oBAC3B,OAAO,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC,CAAC;iBACzB,CAAC,CAAC,IAAI,CAAC,UAAU,MAAM,EAAE;oBACtB,EAAE,eAAe,CAAC;oBAClB,IAAI,IAAI,IAAI,CAAC,IAAI,CAAC,QAAQ,EAAE,MAAM,CAAC,CAAC;oBACpC,SAAS,IAAI,OAAO,CAAC,QAAQ,EAAE,CAAC;iBACnC,EAAE,UAAU,CAAC,EAAE;oBACZ,EAAE,eAAe,CAAC;oBAClB,KAAK,IAAI,KAAK,CAAC,IAAI,CAAC,QAAQ,EAAE,CAAC,CAAC,CAAC;iBACpC,CAAC,CAAC;aACN;YACD,KAAK,EAAE,UAAU,CAAC,EAAE;gBAChB,KAAK,IAAI,KAAK,CAAC,IAAI,CAAC,QAAQ,EAAE,CAAC,CAAC,CAAC;aACpC;YACD,QAAQ,EAAE,YAAY;gBAClB,SAAS,GAAG,IAAI,CAAC;gBACjB,IAAI,CAAC,eAAe,EAAE;oBAClB,QAAQ,IAAI,QAAQ,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;iBACvC;aACJ;SACJ,CAAC;QACF,IAAI,GAAG,GAAG,UAAU,CAAC,SAAS,CAAC,OAAO,CAAC,CAAC;QACxC,OAAO,YAAY,EAAE,OAAO,GAAG,CAAC,WAAW,EAAE,CAAC,EAAE,CAAC;KACpD,CAAC,CAAC;CACN;;;;"}