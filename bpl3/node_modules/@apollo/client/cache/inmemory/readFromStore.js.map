{"version":3,"file":"readFromStore.js","sources":["readFromStore.js"],"sourcesContent":["import { __assign } from \"tslib\";\nimport { wrap } from 'optimism';\nimport { invariant, InvariantError } from 'ts-invariant';\nimport { isField, isInlineFragment, resultKeyNameFromField, isReference, makeReference, } from '../../utilities/graphql/storeUtils';\nimport { createFragmentMap } from '../../utilities/graphql/fragments';\nimport { shouldInclude } from '../../utilities/graphql/directives';\nimport { getDefaultValues, getFragmentDefinitions, getMainDefinition, getQueryDefinition, } from '../../utilities/graphql/getFromAST';\nimport { maybeDeepFreeze } from '../../utilities/common/maybeDeepFreeze';\nimport { mergeDeepArray } from '../../utilities/common/mergeDeep';\nimport { supportsResultCaching } from './entityStore';\nimport { getTypenameFromStoreObject } from './helpers';\n;\nvar StoreReader = (function () {\n    function StoreReader(config) {\n        var _this = this;\n        this.config = config;\n        this.config = __assign({ addTypename: true }, config);\n        var _a = this, executeSelectionSet = _a.executeSelectionSet, executeSubSelectedArray = _a.executeSubSelectedArray;\n        this.executeSelectionSet = wrap(function (options) {\n            return executeSelectionSet.call(_this, options);\n        }, {\n            makeCacheKey: function (_a) {\n                var selectionSet = _a.selectionSet, objectOrReference = _a.objectOrReference, context = _a.context;\n                if (supportsResultCaching(context.store)) {\n                    return context.store.makeCacheKey(selectionSet, JSON.stringify(context.variables), isReference(objectOrReference)\n                        ? objectOrReference.__ref\n                        : objectOrReference);\n                }\n            }\n        });\n        this.executeSubSelectedArray = wrap(function (options) {\n            return executeSubSelectedArray.call(_this, options);\n        }, {\n            makeCacheKey: function (_a) {\n                var field = _a.field, array = _a.array, context = _a.context;\n                if (supportsResultCaching(context.store)) {\n                    return context.store.makeCacheKey(field, array, JSON.stringify(context.variables));\n                }\n            }\n        });\n    }\n    StoreReader.prototype.readQueryFromStore = function (options) {\n        return this.diffQueryAgainstStore(__assign(__assign({}, options), { returnPartialData: false })).result;\n    };\n    StoreReader.prototype.diffQueryAgainstStore = function (_a) {\n        var store = _a.store, query = _a.query, variables = _a.variables, _b = _a.returnPartialData, returnPartialData = _b === void 0 ? true : _b, _c = _a.rootId, rootId = _c === void 0 ? 'ROOT_QUERY' : _c, config = _a.config;\n        var policies = this.config.policies;\n        var execResult = this.executeSelectionSet({\n            selectionSet: getMainDefinition(query).selectionSet,\n            objectOrReference: makeReference(rootId),\n            context: {\n                store: store,\n                query: query,\n                policies: policies,\n                variables: __assign(__assign({}, getDefaultValues(getQueryDefinition(query))), variables),\n                fragmentMap: createFragmentMap(getFragmentDefinitions(query)),\n                getFieldValue: policies.makeFieldValueGetter(store),\n            },\n        });\n        var hasMissingFields = execResult.missing && execResult.missing.length > 0;\n        if (hasMissingFields && !returnPartialData) {\n            execResult.missing.forEach(function (info) {\n                throw new InvariantError(\"Can't find field \" + info.fieldName + \" on object \" + JSON.stringify(info.object, null, 2) + \".\");\n            });\n        }\n        return {\n            result: execResult.result,\n            complete: !hasMissingFields,\n        };\n    };\n    StoreReader.prototype.executeSelectionSet = function (_a) {\n        var _this = this;\n        var selectionSet = _a.selectionSet, objectOrReference = _a.objectOrReference, context = _a.context;\n        var fragmentMap = context.fragmentMap, variables = context.variables, policies = context.policies, getFieldValue = context.getFieldValue;\n        var objectsToMerge = [];\n        var finalResult = { result: null };\n        var typename = getFieldValue(objectOrReference, \"__typename\");\n        if (this.config.addTypename &&\n            typeof typename === \"string\" &&\n            Object.values(policies.rootTypenamesById).indexOf(typename) < 0) {\n            objectsToMerge.push({ __typename: typename });\n        }\n        function getMissing() {\n            return finalResult.missing || (finalResult.missing = []);\n        }\n        function handleMissing(result) {\n            var _a;\n            if (result.missing)\n                (_a = getMissing()).push.apply(_a, result.missing);\n            return result.result;\n        }\n        selectionSet.selections.forEach(function (selection) {\n            var _a;\n            if (!shouldInclude(selection, variables))\n                return;\n            if (isField(selection)) {\n                var fieldValue = policies.readField(objectOrReference, selection, getFieldValue, variables, typename);\n                if (fieldValue === void 0) {\n                    getMissing().push({\n                        object: objectOrReference,\n                        fieldName: selection.name.value,\n                    });\n                }\n                else if (Array.isArray(fieldValue)) {\n                    fieldValue = handleMissing(_this.executeSubSelectedArray({\n                        field: selection,\n                        array: fieldValue,\n                        context: context,\n                    }));\n                }\n                else if (!selection.selectionSet) {\n                    if (process.env.NODE_ENV !== 'production') {\n                        assertSelectionSetForIdValue(context.store, selection, fieldValue);\n                        maybeDeepFreeze(fieldValue);\n                    }\n                }\n                else if (fieldValue != null) {\n                    fieldValue = handleMissing(_this.executeSelectionSet({\n                        selectionSet: selection.selectionSet,\n                        objectOrReference: fieldValue,\n                        context: context,\n                    }));\n                }\n                if (fieldValue !== void 0) {\n                    objectsToMerge.push((_a = {},\n                        _a[resultKeyNameFromField(selection)] = fieldValue,\n                        _a));\n                }\n            }\n            else {\n                var fragment = void 0;\n                if (isInlineFragment(selection)) {\n                    fragment = selection;\n                }\n                else {\n                    invariant(fragment = fragmentMap[selection.name.value], \"No fragment named \" + selection.name.value);\n                }\n                if (policies.fragmentMatches(fragment, typename)) {\n                    objectsToMerge.push(handleMissing(_this.executeSelectionSet({\n                        selectionSet: fragment.selectionSet,\n                        objectOrReference: objectOrReference,\n                        context: context,\n                    })));\n                }\n            }\n        });\n        finalResult.result = mergeDeepArray(objectsToMerge);\n        if (process.env.NODE_ENV !== 'production') {\n            Object.freeze(finalResult.result);\n        }\n        return finalResult;\n    };\n    StoreReader.prototype.executeSubSelectedArray = function (_a) {\n        var _this = this;\n        var field = _a.field, array = _a.array, context = _a.context;\n        var missing;\n        function handleMissing(childResult) {\n            if (childResult.missing) {\n                missing = missing || [];\n                missing.push.apply(missing, childResult.missing);\n            }\n            return childResult.result;\n        }\n        array = array.map(function (item) {\n            if (item === null) {\n                return null;\n            }\n            if (Array.isArray(item)) {\n                return handleMissing(_this.executeSubSelectedArray({\n                    field: field,\n                    array: item,\n                    context: context,\n                }));\n            }\n            if (field.selectionSet) {\n                return handleMissing(_this.executeSelectionSet({\n                    selectionSet: field.selectionSet,\n                    objectOrReference: item,\n                    context: context,\n                }));\n            }\n            if (process.env.NODE_ENV !== 'production') {\n                assertSelectionSetForIdValue(context.store, field, item);\n            }\n            return item;\n        });\n        if (process.env.NODE_ENV !== 'production') {\n            Object.freeze(array);\n        }\n        return { result: array, missing: missing };\n    };\n    return StoreReader;\n}());\nexport { StoreReader };\nfunction assertSelectionSetForIdValue(store, field, fieldValue) {\n    if (!field.selectionSet) {\n        var workSet_1 = new Set([fieldValue]);\n        workSet_1.forEach(function (value) {\n            if (value && typeof value === \"object\") {\n                invariant(!isReference(value), \"Missing selection set for object of type \" + getTypenameFromStoreObject(store, value) + \" returned for query field \" + field.name.value);\n                Object.values(value).forEach(workSet_1.add, workSet_1);\n            }\n        });\n    }\n}\n//# sourceMappingURL=readFromStore.js.map"],"names":[],"mappings":"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"}